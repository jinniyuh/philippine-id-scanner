<!DOCTYPE html>
<html>
<head>
    <title>Test Comprehensive Bago City Validation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .debug { background-color: #f8f9fa; color: #495057; border: 1px solid #dee2e6; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>üß™ Test Comprehensive Bago City Validation</h1>
    
    <div class="info">
        <strong>COMPREHENSIVE VALIDATION:</strong><br>
        ‚úÖ ACCEPT: Contains "BAGO" + "NEGROS OCCIDENTAL" (with various OCR variations)<br>
        ‚ùå REJECT: Contains other cities or missing Negros Occidental
    </div>
    
    <button onclick="testComprehensiveValidation()">Test Comprehensive Validation</button>
    
    <div id="results" class="debug">
        Click the button to test comprehensive validation
    </div>

    <script>
        function testComprehensiveValidation() {
            console.clear();
            console.log('=== TESTING COMPREHENSIVE BAGO CITY VALIDATION ===');
            
            // Test cases covering all possible scenarios
            const testCases = [
                // SHOULD ACCEPT - Standard patterns
                {
                    name: "Standard BAGO CITY",
                    ocrText: "LAG ASAN BAGO CITY NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "Standard CITY OF BAGO",
                    ocrText: "LAG ASAN CITY OF BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "OCR Variation - CITY OF H L BAGO",
                    ocrText: "LAG ASAN CITY OF H L BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "OCR Variation - CITY OF H.L BAGO",
                    ocrText: "LAG ASAN CITY OF H.L BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "OCR Variation - CITY OF HL BAGO",
                    ocrText: "LAG ASAN CITY OF HL BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "OCR Corruption - CHFY 0FBAGO",
                    ocrText: "LAG ASAN CHFY 0FBAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "OCR Corruption - CHFY OF BAGO",
                    ocrText: "LAG ASAN CHFY OF BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "Flexible Match - BAGO + NEGROS OCCIDENTAL",
                    ocrText: "SOME ADDRESS BAGO NEGROS OCCIDENTAL PHILIPPINES",
                    expected: true
                },
                {
                    name: "Complex OCR - Multiple variations",
                    ocrText: "PUROK STA RITA DULAD CHFY 0FBAGO NEGROS OCCIDENTAL",
                    expected: true
                },
                
                // SHOULD REJECT - Non-Bago residents
                {
                    name: "Pulupandan Resident",
                    ocrText: "BARANGAY TAPONG PULUPANDAN NEGROS OCCIDENTAL",
                    expected: false
                },
                {
                    name: "Manila Resident",
                    ocrText: "BARANGAY 526 SAMPALOK MANILA CITY METRO MANILA",
                    expected: false
                },
                {
                    name: "Bago City without Negros Occidental",
                    ocrText: "SOME ADDRESS BAGO CITY PHILIPPINES",
                    expected: false
                },
                {
                    name: "Negros Occidental without Bago",
                    ocrText: "SOME ADDRESS NEGROS OCCIDENTAL PHILIPPINES",
                    expected: false
                }
            ];
            
            let results = [];
            
            testCases.forEach((testCase, index) => {
                console.log(`\n--- TEST ${index + 1}: ${testCase.name} ---`);
                
                const result = validateComprehensiveBagoResident(testCase.ocrText);
                const success = result === testCase.expected;
                
                console.log(`Expected: ${testCase.expected ? 'ACCEPT' : 'REJECT'}`);
                console.log(`Actual: ${result ? 'ACCEPT' : 'REJECT'}`);
                console.log(`Status: ${success ? '‚úÖ PASS' : '‚ùå FAIL'}`);
                
                results.push({
                    name: testCase.name,
                    expected: testCase.expected ? 'ACCEPT' : 'REJECT',
                    actual: result ? 'ACCEPT' : 'REJECT',
                    success: success
                });
            });
            
            // Display results
            displayResults(results);
        }
        
        function validateComprehensiveBagoResident(ocrText) {
            // Copy the exact comprehensive validation logic from login.php
            
            // Step 1: Check for other cities
            const otherCities = [
                'PULUPANDAN', 'TALISAY', 'BACOLOD', 'SILAY', 'VICTORIAS', 'CADIZ', 
                'SAGAY', 'ESCALANTE', 'MANAPLA', 'VALLADOLID', 'MURCIA', 'SALVADOR BENEDICTO',
                'LA CARLOTA', 'LA CASTELLANA', 'MOISES PADILLA', 'ISABELA', 'BINALBAGAN',
                'HIMAMAYLAN', 'KABANKALAN', 'ILOG', 'CAUAYAN', 'CANDONI', 'HINIGARAN',
                'PONTEVEDRA', 'HINOBA AN', 'SIPALAY', 'CALATRAVA', 'TOBOSO', 'SAN CARLOS',
                'MANILA'
            ];
            
            for (let city of otherCities) {
                if (ocrText.toUpperCase().includes(city.toUpperCase())) {
                    return false; // REJECT immediately
                }
            }
            
            // Step 2: Check for STRICT Bago City + Negros Occidental patterns
            const strictBagoPatterns = [
                'BAGO CITY NEGROS OCCIDENTAL',
                'CITY OF BAGO NEGROS OCCIDENTAL',
                'CITY OF H L BAGO NEGROS OCCIDENTAL',
                'CITY OF H.L BAGO NEGROS OCCIDENTAL',
                'CITY OF HL BAGO NEGROS OCCIDENTAL',
                'CHFY 0FBAGO NEGROS OCCIDENTAL',
                'CHFY OF BAGO NEGROS OCCIDENTAL'
            ];
            
            let foundBagoIndicator = false;
            for (let pattern of strictBagoPatterns) {
                if (ocrText.toUpperCase().includes(pattern.toUpperCase())) {
                    foundBagoIndicator = true;
                    break;
                }
            }
            
            // Step 3: Flexible pattern matching for OCR variations
            if (!foundBagoIndicator) {
                const hasBago = ocrText.toUpperCase().includes('BAGO');
                const hasNegrosOccidental = ocrText.toUpperCase().includes('NEGROS OCCIDENTAL');
                
                if (hasBago && hasNegrosOccidental) {
                    // Check if it's not another city (already checked above)
                    foundBagoIndicator = true; // Flexible match
                }
            }
            
            return foundBagoIndicator;
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            
            let html = '<h3>Comprehensive Validation Test Results:</h3>';
            
            results.forEach((result, index) => {
                const statusClass = result.success ? 'success' : 'error';
                const statusIcon = result.success ? '‚úÖ' : '‚ùå';
                
                html += `
                    <div class="result ${statusClass}">
                        <strong>${statusIcon} ${result.name}</strong><br>
                        Expected: ${result.expected}<br>
                        Actual: ${result.actual}<br>
                        Status: ${result.success ? 'PASS' : 'FAIL'}
                    </div>
                `;
            });
            
            const totalPassed = results.filter(r => r.success).length;
            const totalTests = results.length;
            
            html += `
                <div class="result ${totalPassed === totalTests ? 'success' : 'error'}">
                    <strong>Overall Result: ${totalPassed}/${totalTests} tests passed</strong><br>
                    ${totalPassed === totalTests ? 'Comprehensive validation working correctly!' : 'Some tests failed - check the patterns!'}
                </div>
            `;
            
            resultsDiv.innerHTML = html;
            
            console.log(`\n=== FINAL RESULTS ===`);
            console.log(`Passed: ${totalPassed}/${totalTests}`);
            console.log(`Status: ${totalPassed === totalTests ? '‚úÖ ALL PASS' : '‚ùå SOME FAIL'}`);
        }
    </script>
</body>
</html>
